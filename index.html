<index class="html"></index>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generador de Prompts de IA - Tu Plataforma</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f3f4f6; /* Fondo gris claro */
        }
        .header {
            background-color: #1e3a8a; /* Azul oscuro para el encabezado */
            color: white;
            padding: 1.5rem 0;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .main-content {
            display: grid;
            gap: 2rem;
            padding: 2rem 1rem;
            max-width: 1200px; /* Ancho máximo para el contenido principal */
            margin: 0 auto;
            grid-template-columns: 1fr; /* Una columna por defecto */
        }
        @media (min-width: 768px) { /* Tablet y escritorio */
            .main-content {
                grid-template-columns: 1.5fr 1fr; /* Generador más amplio, tips a la derecha */
            }
        }
        @media (min-width: 1024px) { /* Escritorio grande */
            .main-content {
                grid-template-columns: 2fr 1fr; /* Generador aún más amplio */
            }
        }
        .section-card {
            background-color: #ffffff;
            border-radius: 1rem; /* Bordes más redondeados */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            padding: 2rem;
        }
        /* Estilos para el spinner de carga */
        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            border-left-color: #3b82f6; /* Color azul de Tailwind */
            animation: spin 1s ease infinite;
            display: none; /* Oculto por defecto */
            margin-left: 1rem;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Estilos para el área de resultados si hay scroll */
        .result-area {
            max-height: 400px; /* Altura máxima */
            overflow-y: auto; /* Scroll vertical si el contenido excede la altura */
            white-space: pre-wrap; /* Mantiene saltos de línea y espacios */
            word-break: break-word; /* Rompe palabras largas para evitar desbordamiento */
        }
        .footer {
            background-color: #374151; /* Gris oscuro para el pie de página */
            color: white;
            text-align: center;
            padding: 2rem 0;
            margin-top: 2rem;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container mx-auto">
            <h1 class="text-4xl font-extrabold mb-2">PromptFlow AI</h1>
            <p class="text-xl font-light">Tu asistente para prompts de alta calidad</p>
        </div>
    </header>

    <!-- Main Content Grid -->
    <div class="main-content">
        <!-- Generador de Prompts -->
        <div class="section-card">
            <h2 class="text-2xl font-bold text-gray-800 mb-6">Generador de Prompts</h2>
            <p class="text-gray-600 mb-6">
                Describe detalladamente lo que quieres que la IA haga por ti. Cuanta más información, mejor será el prompt.
            </p>

            <div class="mb-6">
                <label for="userPromptInput" class="block text-gray-700 text-sm font-medium mb-2">
                    Tu solicitud (ej: "Necesito un prompt para escribir un correo de agradecimiento a mi jefe")
                </label>
                <textarea id="userPromptInput" rows="7"
                          class="w-full p-4 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out text-base"
                          placeholder="Describe aquí tu tarea o lo que deseas que la IA genere..."></textarea>
            </div>

            <div class="flex items-center justify-center mb-6">
                <button id="generatePromptButton"
                        class="bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-8 rounded-lg shadow-md transition duration-200 ease-in-out transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                    Generar Prompt
                </button>
                <div id="loadingSpinner" class="spinner"></div>
            </div>

            <!-- Message Box for Errors/Info -->
            <div id="messageBox" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded-lg relative mb-6" role="alert">
                <strong class="font-bold">¡Error!</strong>
                <span class="block sm:inline" id="messageText"></span>
            </div>

            <!-- Área donde se recibe el prompt generado -->
            <div id="promptOutputContainer" class="hidden mt-8">
                <h2 class="text-2xl font-bold text-gray-800 mb-4">Prompt Generado:</h2>
                <div id="generatedPromptOutput"
                     class="result-area bg-gray-50 border border-gray-200 rounded-lg p-5 text-gray-800 text-sm leading-relaxed overflow-x-auto selection:bg-blue-200">
                    <!-- El prompt generado se insertará aquí -->
                </div>
                <button id="copyPromptButton"
                        class="mt-4 bg-gray-200 hover:bg-gray-300 text-gray-800 font-semibold py-2 px-5 rounded-lg shadow-sm transition duration-200 ease-in-out text-base focus:outline-none focus:ring-2 focus:ring-gray-400 focus:ring-offset-2">
                    Copiar al Portapapeles
                </button>
                <div id="copyConfirmation" class="text-green-600 text-sm mt-2 hidden">¡Copiado!</div>
            </div>

            <div id="sourcesOutputContainer" class="hidden mt-6">
                <h2 class="text-xl font-semibold text-gray-800 mb-4">Fuentes (si aplica):</h2>
                <ul id="sourcesList" class="list-disc list-inside text-gray-700 text-sm pl-4">
                    <!-- Las fuentes se insertarán aquí -->
                </ul>
            </div>
        </div>

        <!-- Información y Tips -->
        <div class="section-card bg-blue-50/50"> <!-- Fondo ligeramente diferente para destacar -->
            <h2 class="text-2xl font-bold text-blue-800 mb-6">Información y Consejos para Prompts</h2>
            <div class="space-y-6 text-gray-700">
                <div>
                    <h3 class="font-semibold text-lg mb-2">¿Qué es un buen prompt?</h3>
                    <p>Un prompt efectivo es claro, conciso y directo. Guía a la IA hacia la respuesta que necesitas, minimizando ambigüedades. Imagina que le estás dando instrucciones a un asistente muy inteligente, pero que necesita detalles.</p>
                </div>
                <div>
                    <h3 class="font-semibold text-lg mb-2">Componentes clave:</h3>
                    <ul class="list-disc list-inside space-y-1 pl-4">
                        <li><strong>Instrucción:</strong> La acción principal (ej: "Escribe", "Resume", "Genera ideas").</li>
                        <li><strong>Contexto:</strong> Información de fondo relevante.</li>
                        <li><strong>Ejemplos:</strong> Si necesitas un formato o tono específico, muestra cómo.</li>
                        <li><strong>Restricciones:</strong> Límites de longitud, estilo, palabras clave a incluir/excluir.</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold text-lg mb-2">Técnicas avanzadas:</h3>
                    <ul class="list-disc list-inside space-y-1 pl-4">
                        <li><strong>Chain of Thought (CoT):</strong> Pide a la IA que piense paso a paso.</li>
                        <li><strong>Few-shot Prompting:</strong> Dale ejemplos de entradas y salidas deseados.</li>
                        <li><strong>ASPECT:</strong> Utiliza este acrónimo para no olvidar ningún detalle: <strong>A</strong>cción, <strong>S</strong>ujeto, <strong>P</strong>ropósito, <strong>E</strong>jemplos, <strong>C</strong>onstraints (Restricciones), <strong>T</strong>ono.</li>
                    </ul>
                </div>
                <div>
                    <h3 class="font-semibold text-lg mb-2">Recomendaciones:</h3>
                    <p>Sé específico, evita la ambigüedad, experimenta con diferentes formulaciones y ¡no temas pedirle a la IA que te ayude a mejorar tu propio prompt!</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="footer">
        <p>&copy; 2025 PromptFlow AI. Todos los derechos reservados.</p>
    </footer>

    <script type="module">
        // Obtener elementos del DOM
        const userPromptInput = document.getElementById('userPromptInput');
        const generatePromptButton = document.getElementById('generatePromptButton');
        const loadingSpinner = document.getElementById('loadingSpinner');
        const promptOutputContainer = document.getElementById('promptOutputContainer');
        const generatedPromptOutput = document.getElementById('generatedPromptOutput');
        const copyPromptButton = document.getElementById('copyPromptButton');
        const copyConfirmation = document.getElementById('copyConfirmation');
        const messageBox = document.getElementById('messageBox');
        const messageText = document.getElementById('messageText');
        const sourcesOutputContainer = document.getElementById('sourcesOutputContainer');
        const sourcesList = document.getElementById('sourcesList');

        // Configuración de la API de Gemini
        // La clave de API se proporciona automáticamente por el entorno de Canvas si está vacía.
        const apiKey = "AIzaSyAbiPiKFjuGHZ5qL8XCrr-kR0SXluBXzEk";
        const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

        // Mensaje del Sistema
        const systemPrompt = `Eres un "Generador de Prompts", un agente experto en ingeniería de prompts. Tu función es ayudar a los usuarios a diseñar, ajustar y refinar sus instrucciones para obtener los mejores resultados posibles de los modelos de IA. Tu objetivo es maximizar la calidad, relevancia y utilidad de las respuestas generadas.`;

        // Contexto y Conocimiento
        const context = `### Componentes clave de un prompt efectivo:
- **Instrucción:** Define la acción que el modelo debe realizar.
- **Contexto:** Proporciona información de fondo para la tarea.
- **Ejemplos:** Demuestra el formato, tono o estilo deseado.
- **Restricciones de Salida:** Limita el formato, la longitud o el estilo de la respuesta.

### Técnicas avanzadas que puedes recomendar:
- **Chain of Thought (CoT):** Desglosa problemas complejos en pasos lógicos para mejorar la precisión.
- **Few-shot Prompting:** Incluye varios ejemplos para que el modelo aprenda un patrón específico.
- **ASPECT:** Un acrónimo para prompts detallados (Acción, Sujeto, Propósito, Ejemplos, Restricciones, Tono).`;

        /**
         * Muestra un mensaje de error al usuario.
         * @param {string} message - El mensaje de error a mostrar.
         */
        function showMessage(message) {
            messageText.textContent = message;
            messageBox.classList.remove('hidden');
            setTimeout(() => {
                messageBox.classList.add('hidden');
            }, 5000); // Oculta el mensaje después de 5 segundos
        }

        /**
         * Realiza una llamada a la API con reintentos y retroceso exponencial.
         * @param {object} payload - El cuerpo de la solicitud para la API.
         * @param {number} retries - Número de reintentos restantes.
         * @param {number} delay - Retraso inicial en milisegundos.
         * @returns {Promise<object>} La respuesta de la API.
         */
        async function callApiWithBackoff(payload, retries = 5, delay = 1000) {
            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const responseText = await response.text(); // Siempre lee la respuesta como texto primero

                let responseJson = null;
                // Intenta parsear la respuesta como JSON solo si no está vacía
                if (responseText) {
                    try {
                        responseJson = JSON.parse(responseText);
                    } catch (parseError) {
                        console.error("Error al parsear la respuesta JSON:", parseError);
                        console.error("Respuesta RAW de la API:", responseText);
                        throw new Error("Respuesta inválida de la API: no es JSON válido.");
                    }
                }

                if (!response.ok) {
                    if (response.status === 429 && retries > 0) {
                        // Demasiadas solicitudes, reintentar con retroceso exponencial
                        await new Promise(res => setTimeout(res, delay));
                        return callApiWithBackoff(payload, retries - 1, delay * 2);
                    }
                    // Si no OK, y tenemos un mensaje de error JSON, lo usamos. De lo contrario, statusText o raw text.
                    const errorMessage = responseJson?.error?.message || responseText || response.statusText;
                    throw new Error(`Error ${response.status}: ${errorMessage}`);
                }

                // Si la respuesta fue OK, esperamos un JSON válido. Si responseJson es null aquí, algo salió mal.
                if (responseJson === null) {
                    throw new Error("Respuesta exitosa de la API, pero el cuerpo está vacío o no es JSON.");
                }

                return responseJson;

            } catch (error) {
                console.error("Error en la llamada a la API (capturado):", error);
                throw error;
            }
        }

        // Manejador del botón de generar prompt
        generatePromptButton.addEventListener('click', async () => {
            const userPrompt = userPromptInput.value.trim();

            if (!userPrompt) {
                showMessage('Por favor, ingresa tu solicitud para generar un prompt.');
                return;
            }

            // Construir el mensaje completo para la API
            const fullPrompt = `${systemPrompt}\n\n${context}\n\n${userPrompt}`;

            const payload = {
                contents: [{ parts: [{ text: fullPrompt }] }],
                tools: [{ "google_search": {} }], // Habilita Google Search grounding
                systemInstruction: {
                    parts: [{ text: systemPrompt }]
                },
            };

            // Mostrar spinner de carga y deshabilitar botón
            loadingSpinner.style.display = 'block';
            generatePromptButton.disabled = true;
            generatedPromptOutput.textContent = '';
            promptOutputContainer.classList.add('hidden');
            sourcesOutputContainer.classList.add('hidden');
            sourcesList.innerHTML = '';
            copyConfirmation.classList.add('hidden');

            try {
                const result = await callApiWithBackoff(payload);
                const candidate = result.candidates?.[0];

                if (candidate && candidate.content?.parts?.[0]?.text) {
                    const text = candidate.content.parts[0].text;
                    generatedPromptOutput.textContent = text;
                    promptOutputContainer.classList.remove('hidden');

                    let sources = [];
                    const groundingMetadata = candidate.groundingMetadata;
                    if (groundingMetadata && groundingMetadata.groundingAttributions) {
                        sources = groundingMetadata.groundingAttributions
                            .map(attribution => ({
                                uri: attribution.web?.uri,
                                title: attribution.web?.title,
                            }))
                            .filter(source => source.uri && source.title);

                        if (sources.length > 0) {
                            sourcesList.innerHTML = sources.map(source =>
                                `<li><a href="${source.uri}" target="_blank" class="text-blue-600 hover:underline">${source.title}</a></li>`
                            ).join('');
                            sourcesOutputContainer.classList.remove('hidden');
                        }
                    }
                } else {
                    showMessage('No se pudo generar un prompt. Inténtalo de nuevo.');
                    console.error('Estructura de respuesta inesperada:', result);
                }
            } catch (error) {
                showMessage(`Ocurrió un error al generar el prompt: ${error.message}`);
            } finally {
                // Ocultar spinner de carga y habilitar botón
                loadingSpinner.style.display = 'none';
                generatePromptButton.disabled = false;
            }
        });

        // Manejador del botón de copiar al portapapeles
        copyPromptButton.addEventListener('click', () => {
            const promptToCopy = generatedPromptOutput.textContent;
            if (promptToCopy) {
                // Usa document.execCommand para compatibilidad en iframes
                const textArea = document.createElement("textarea");
                textArea.value = promptToCopy;
                textArea.style.position = "fixed"; // Para que no afecte el scroll
                textArea.style.opacity = "0"; // Invisible
                document.body.appendChild(textArea);
                textArea.focus();
                textArea.select();
                try {
                    document.execCommand('copy');
                    copyConfirmation.classList.remove('hidden');
                    setTimeout(() => {
                        copyConfirmation.classList.add('hidden');
                    }, 2000); // Oculta la confirmación después de 2 segundos
                } catch (err) {
                    console.error('Error al copiar al portapapeles:', err);
                    showMessage('No se pudo copiar el texto. Por favor, cópialo manualmente.');
                }
                document.body.removeChild(textArea);
            }
        });
    </script>
</body>
</html>
